<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Platforma Za≈Çadunku i Roz≈Çadunku</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const supabase = window.supabase.createClient(
      'https://bfknyzfmhojjghhkxyrv.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJma255emZtaG9qamdoaGt4eXJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyOTc4NTYsImV4cCI6MjA2Mzg3Mzg1Nn0.pQbR3wHdzhE4nP7PEIn5rASLNNwFa3-qKqkymDgxVLc'
    );

    async function autoSave(row) {
      if (!row || !row.cells || row.cells.length < 13) return;
      const input = (i) => row.cells[i]?.querySelector("input, select, textarea")?.value?.trim() || "";

      const dane = {
        zaladunek: input(1),
        data_zaladunku_od: row.cells[2].querySelectorAll("input")[0]?.value.trim() || "",
        data_zaladunku_do: row.cells[2].querySelectorAll("input")[1]?.value.trim() || "",
        godzina_zaladunku_od: row.cells[3].querySelectorAll("input")[0]?.value.trim() || "",
        godzina_zaladunku_do: row.cells[3].querySelectorAll("input")[1]?.value.trim() || "",
        rozladunek: input(4),
        data_rozladunku_od: row.cells[5].querySelectorAll("input")[0]?.value.trim() || "",
        data_rozladunku_do: row.cells[5].querySelectorAll("input")[1]?.value.trim() || "",
        godzina_rozladunku_od: row.cells[6].querySelectorAll("input")[0]?.value.trim() || "",
        godzina_rozladunku_do: row.cells[6].querySelectorAll("input")[1]?.value.trim() || "",
        sposob_zaladunku: input(7),
        aktualnosc: input(8),
        uwagi: input(9),
        stawka: input(10),
        kilometry: input(11),
        stawka_km: input(12)
      };

      const filled = Object.values(dane).filter(v => v !== "").length;
      if (filled < 2) {
        console.log("‚õî Pominiƒôto zapis ‚Äì mniej ni≈º 2 pola");
        return;
      }

      if (row.dataset.id) {
        const { error } = await supabase.from("translider").update(dane).eq("id", row.dataset.id);
        if (error) {
          console.error("‚ùå B≈ÇƒÖd aktualizacji:", error.message);
        } else {
          console.log("üîÅ Zaktualizowano wiersz:", row.dataset.id);
        }
      } else {
        const { data, error } = await supabase.from("translider").insert([dane]).select("id");
        if (error) {
          console.error("‚ùå B≈ÇƒÖd zapisu:", error.message);
        } else {
          console.log("‚úÖ Zapisano wiersz:", data[0]?.id);
          row.dataset.zapisany = "true";
          row.dataset.id = data[0]?.id;
        }
      }
    }

    document.addEventListener("change", (e) => {
      const row = e.target.closest("tr");
      if (row) autoSave(row);
    });

    document.addEventListener("blur", (e) => {
      const row = e.target.closest("tr");
      if (row) autoSave(row);
    }, true);
  </script>
  <style>
    body { font-family: Arial, sans-serif; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
    input, textarea, select { width: 100%; box-sizing: border-box; }
  </style>
</head>
<body>
  <table id="tabela">
    <thead>
      <tr>
        <th>#</th>
        <th>Za≈Çadunek</th>
        <th>Data Za≈Ç. (od-do)</th>
        <th>Godz. Za≈Ç. (od-do)</th>
        <th>Roz≈Çadunek</th>
        <th>Data Roz≈Ç. (od-do)</th>
        <th>Godz. Roz≈Ç. (od-do)</th>
        <th>Spos√≥b Za≈Ç.</th>
        <th>Aktualno≈õƒá</th>
        <th>Uwagi</th>
        <th>Stawka</th>
        <th>Kilometry</th>
        <th>Stawka/km</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td><input type="text" /></td>
        <td><input type="date" /> <input type="date" /></td>
        <td><input type="time" /> <input type="time" /></td>
        <td><input type="text" /></td>
        <td><input type="date" /> <input type="date" /></td>
        <td><input type="time" /> <input type="time" /></td>
        <td><input type="text" /></td>
        <td><select><option>Aktualne</option><option>Nieaktualne</option></select></td>
        <td><textarea></textarea></td>
        <td><input type="number" step="0.01" /></td>
        <td><input type="number" step="1" /></td>
        <td><input type="number" step="0.01" /></td>
      </tr>
    </tbody>
  </table>
</body>
</html>
