<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Platforma Za�adunku i Roz�adunku</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    .pilne { background-color: #ffe6e6; }
    .status-aktualne { background-color: #a5f3a1 !important; font-weight: bold; }
    .status-nieaktualne { background-color: #f9a1a1 !important; font-weight: bold; }
    .status-nieznane { background-color: #fff7a1 !important; font-weight: bold; }
    .date-time-group input {
      width: 45%;
      display: inline-block;
      margin: 2px 1%;
    }
    textarea { width: 100%; height: 60px; resize: vertical; }
    input[list], input[type="text"] { width: 100%; }
    #map { height: 400px; margin-top: 30px; }
  </style>
</head>
<body>

<div id="truck-ban-widget" style="margin: 10px 0; text-align: center;">
  <button onclick="toggleTruckWidget()" style="margin-bottom: 5px;">Poka�/Ukryj zakazy ruchu</button>
  <div id="truck-widget-frame">
    <iframe src="https://trafficban.com/plugins/box.html?language=pl" width="100%" height="300" frameborder="0"></iframe>
  </div>
</div>

<h1>Platforma Za�adunku i Roz�adunku</h1>
<button onclick="dodajWiersz()">? Dodaj nowy wiersz</button>
<datalist id="lokalizacje"></datalist>

<table id="tabela">
  <thead>
    <tr>
      <th>PILNE</th>
      <th>Za�adunek</th>
      <th>Data za�adunku (od-do)</th>
      <th>Godzina za�adunku (od-do)</th>
      <th>Roz�adunek</th>
      <th>Data roz�adunku (od-do)</th>
      <th>Godzina roz�adunku (od-do)</th>
      <th>Spos�b za�adunku</th>
      <th>Potwierd� aktualno��</th>
      <th>Uwagi</th>
      <th>Stawka</th>
      <th>Kilometry</th>
      <th>Stawka z km</th>
      <th>Mapka</th>
      <th>Akcje</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div id="map"></div>

<script>
function toggleTruckWidget() {
  const frame = document.getElementById("truck-widget-frame");
  frame.style.display = (frame.style.display === "none") ? "block" : "none";
}
</script>

<script>
window.addEventListener('DOMContentLoaded', () => {
  fetch("kodypolska.json")
    .then(response => response.json())
    .then(data => {
      const datalist = document.getElementById("lokalizacje");
      data.forEach(entry => {
        const label = `${entry.postal_code} ${entry.place_name}`.trim();
        const option = document.createElement("option");
        option.value = label;
        datalist.appendChild(option);
      });
    })
    .catch(error => console.error("B��d podczas �adowania lokalizacji:", error));
});
</script>


<div id="mapa-targeo" style="margin-top: 30px; display:none;">
  <h3>Mapa Targeo � trasa za�adunek ? roz�adunek</h3>
  <iframe id="iframe-mapa" width="100%" height="500" frameborder="0"></iframe>
</div>

</body>

<script>
function pokazMape(btn) {
  const row = btn.closest("tr");
  const zaladunek = row.cells[1].querySelector("input")?.value || '';
  const rozladunek = row.cells[4].querySelector("input")?.value || '';

  if (!zaladunek || !rozladunek) {
    alert("Uzupe�nij miejscowo�ci za�adunku i roz�adunku.");
    return;
  }

  const start = encodeURIComponent(zaladunek);
  const end = encodeURIComponent(rozladunek);
  const mapaUrl = `https://targeo.pl/routeCalc.php?from=${start}&to=${end}`;

  document.getElementById("iframe-mapa").src = mapaUrl;
  document.getElementById("mapa-targeo").style.display = "block";
}
</script>
</html>