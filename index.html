
<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Platforma Za≈Çadunku i Roz≈Çadunku</title>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const client = window.supabase.createClient(
      'https://bfknyzfmhojjghhkxyrv.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJma255emZtaG9qamdoaGt4eXJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyOTc4NTYsImV4cCI6MjA2Mzg3Mzg1Nn0.pQbR3wHdzhE4nP7PEIn5rASLNNwFa3-qKqkymDgxVLc'
    );
  </script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    .pilne { background-color: #ffe6e6; }
    .status-aktualne { background-color: #a5f3a1 !important; font-weight: bold; }
    .status-nieaktualne { background-color: #f9a1a1 !important; font-weight: bold; }
    .status-nieznane { background-color: #fff7a1 !important; font-weight: bold; }
    .date-time-group input {
      width: 45%;
      display: inline-block;
      margin: 2px 1%;
    }
    textarea { width: 100%; height: 60px; resize: vertical; }
    input[list], input[type="text"] { width: 100%; }
    #targeoMap, #map {
      width: 100%;
      height: 500px;
      margin-top: 30px;
      border: none;
    }
  </style>
</head>
<body>
  
<div id="truck-ban-widget" style="margin: 10px 0; text-align: center;">
  <button onclick="toggleTruckWidget()" style="margin-bottom: 5px;">Poka≈º/Ukryj zakazy ruchu</button>
  <div id="truck-widget-frame">
    <iframe src="https://trafficban.com/plugins/box.html?language=pl" width="100%" height="300" frameborder="0"></iframe>
  </div>
</div>

<h1>Platforma Za≈Çadunku i Roz≈Çadunku</h1>
<button onclick="dodajWiersz()">‚ûï Dodaj nowy wiersz</button>
<button onclick="zapiszDane()">üíæ Zapisz dane</button>
<datalist id="lokalizacje"></datalist>
<table id="tabela">
  <thead>
    <tr>
      <th>PILNE</th><th>Za≈Çadunek</th><th>Data za≈Çadunku (od-do)</th><th>Godzina za≈Çadunku (od-do)</th>
      <th>Roz≈Çadunek</th><th>Data roz≈Çadunku (od-do)</th><th>Godzina roz≈Çadunku (od-do)</th>
      <th>Spos√≥b za≈Çadunku</th><th>Potwierd≈∫ aktualno≈õƒá</th><th>Uwagi</th>
      <th>Stawka</th><th>Kilometry</th><th>Stawka z km</th><th>Mapka</th><th>Akcje</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<div id="map" style="height: 500px; margin-top: 30px;"></div>

<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script>
function toggleTruckWidget() {
  const frame = document.getElementById("truck-widget-frame");
  frame.style.display = (frame.style.display === "none") ? "block" : "none";
}

window.addEventListener('DOMContentLoaded', async () => {
  try {
    const res = await fetch('kodypolska.json');
    const data = await res.json();
    const datalist = document.getElementById("lokalizacje");
    data.forEach(entry => {
      const option = document.createElement("option");
      option.value = `${entry.place_name} ${entry.postal_code}`;
      datalist.appendChild(option);
    });
  } catch (error) {
    console.error("B≈ÇƒÖd ≈Çadowania kodypolska.json:", error);
  }

  // Za≈Çaduj dane z bazy Supabase
  const { data, error } = await client.from("translider").select("*");
  if (error) {
    console.error("‚ùå B≈ÇƒÖd pobierania danych:", error);
    alert("‚ùå Nie uda≈Ço siƒô pobraƒá danych z bazy: " + error.message);
    return;
  }

  const tabela = document.querySelector("#tabela tbody");
  data.forEach(entry => {
    const row = tabela.insertRow();
    row.innerHTML = `
      <td><input type="checkbox" checked></td>
      <td><input type="text" value="${entry.zaladunek || ''}" list="lokalizacje"></td>
      <td class="date-time-group"><input type="date" value="${entry.data_zaladunku_od || ''}"> <input type="date" value="${entry.data_zaladunku_do || ''}"></td>
      <td class="date-time-group"><input type="time" value="${entry.godzina_zaladunku_od || ''}"> <input type="time" value="${entry.godzina_zaladunku_do || ''}"></td>
      <td><input type="text" value="${entry.rozladunek || ''}" list="lokalizacje"></td>
      <td class="date-time-group"><input type="date" value="${entry.data_rozladunku_od || ''}"> <input type="date" value="${entry.data_rozladunku_do || ''}"></td>
      <td class="date-time-group"><input type="time" value="${entry.godzina_rozladunku_od || ''}"> <input type="time" value="${entry.godzina_rozladunku_do || ''}"></td>
      <td><select><option selected>${entry.sposob_zaladunku || ''}</option></select></td>
      <td><select><option selected>${entry.aktualnosc || ''}</option></select></td>
      <td><textarea>${entry.uwagi || ''}</textarea></td>
      <td><input type="text" value="${entry.stawka || ''}"></td>
      <td><input type="text" value="${entry.kilometry || ''}"></td>
      <td><input type="text" value="${entry.stawka_km || ''}"></td>
      <td><input type="checkbox"></td>
      <td><button onclick="this.closest('tr').remove()">üóëÔ∏è Usu≈Ñ</button></td>`;
  });
});

function dodajWiersz() {
  const tabela = document.querySelector("#tabela tbody");
  const row = tabela.insertRow();
  row.innerHTML = `
    <td><input type="checkbox" checked></td>
    <td><input type="text" list="lokalizacje"></td>
    <td class="date-time-group"><input type="date"> <input type="date"></td>
    <td class="date-time-group"><input type="time"> <input type="time"></td>
    <td><input type="text" list="lokalizacje"></td>
    <td class="date-time-group"><input type="date"> <input type="date"></td>
    <td class="date-time-group"><input type="time"> <input type="time"></td>
    <td><select><option value="">Wybierz</option></select></td>
    <td><select><option value="">--</option></select></td>
    <td><textarea></textarea></td>
    <td><input type="text"></td>
    <td><input type="text"></td>
    <td><input type="text"></td>
    <td><input type="checkbox"></td>
    <td><button onclick="this.closest('tr').remove()">üóëÔ∏è Usu≈Ñ</button></td>`;
}

async function zapiszDane() {
  const rows = document.querySelectorAll("#tabela tbody tr");
  for (const row of rows) {
    const input = (i) => row.cells[i]?.querySelector("input, select, textarea")?.value || "";
    const dane = {
      zaladunek: input(1),
      data_zaladunku_od: row.cells[2].querySelectorAll("input")[0].value,
      data_zaladunku_do: row.cells[2].querySelectorAll("input")[1].value,
      godzina_zaladunku_od: row.cells[3].querySelectorAll("input")[0].value,
      godzina_zaladunku_do: row.cells[3].querySelectorAll("input")[1].value,
      rozladunek: input(4),
      data_rozladunku_od: row.cells[5].querySelectorAll("input")[0].value,
      data_rozladunku_do: row.cells[5].querySelectorAll("input")[1].value,
      godzina_rozladunku_od: row.cells[6].querySelectorAll("input")[0].value,
      godzina_rozladunku_do: row.cells[6].querySelectorAll("input")[1].value,
      sposob_zaladunku: input(7),
      aktualnosc: input(8),
      uwagi: input(9),
      stawka: input(10),
      kilometry: input(11),
      stawka_km: input(12),
    };
    const { error } = await client.from("translider").insert([dane]);
    if (error) {
      console.error("‚ùå B≈ÇƒÖd zapisu:", error.message);
      alert("‚ùå B≈ÇƒÖd zapisu: " + error.message);
    }
  }
  alert("‚úÖ Dane zapisane do Supabase!");
}
</script>


<script>
const map = L.map('map').setView([52.2297, 21.0122], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '¬© OpenStreetMap',
  maxZoom: 18
}).addTo(map);
</script>

</body>
</html>
