
<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Platforma ZaĹ‚adunku i RozĹ‚adunku</title>
  <style>
    .pilne { background-color: #ffbebe; font-weight: bold; }
    button { cursor: pointer; }
  </style>
</head>
<body>
  <table>
    <thead>
      <tr>
        <th>Pilne</th><th>ZaĹ‚adunek</th><th>Data ZaĹ‚adunku</th><th>Godz. ZaĹ‚adunku</th>
        <th>RozĹ‚adunek</th><th>Data RozĹ‚adunku</th><th>Godz. RozĹ‚adunku</th><th>SposĂłb</th>
        <th>Status</th><th>Uwagi</th><th>Stawka</th><th>KM</th><th>Stawka/KM</th>
        <th>Mapa</th><th>UsuĹ„</th>
      </tr>
    </thead>
    <tbody id="tabela"></tbody>
  </table>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const supabaseUrl = 'https://bfknyzfmhojjghhkxyrv.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJma255emZtaG9qamdoaGt4eXJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyOTc4NTYsImV4cCI6MjA2Mzg3Mzg1Nn0.pQbR3wHdzhE4nP7PEIn5rASLNNwFa3-qKqkymDgxVLc';
    const client = supabase.createClient(supabaseUrl, supabaseKey);
    const tabela = document.getElementById("tabela");

    function podlaczZdarzeniaDoWiersza(row) {
      const pilneCheckbox = row.querySelector(".pilne-check");
      if (pilneCheckbox) {
        pilneCheckbox.onchange = () => {
          row.classList.toggle("pilne");
          sortujPilneNaTopie();
        };
      }

      const mapaCheckbox = row.querySelector(".mapa-check");
      if (mapaCheckbox) {
        mapaCheckbox.onchange = () => {
          const z = row.children[1].querySelector("input").value;
          const r = row.children[4].querySelector("input").value;
          if (z && r) window.open(`https://www.google.com/maps/dir/${z}/${r}`, "_blank");
        };
      }

      const usunBtn = row.querySelector("button");
      if (usunBtn) {
        usunBtn.onclick = () => {
          const id = row.dataset.id;
          if (id) {
            client.from("zlecenia").delete().eq("id", id).then(() => row.remove());
          } else {
            row.remove();
          }
        };
      }
    }

    function sortujPilneNaTopie() {
      const rows = Array.from(tabela.querySelectorAll("tr"));
      rows.sort((a, b) => {
        const ap = a.classList.contains("pilne") ? 1 : 0;
        const bp = b.classList.contains("pilne") ? 1 : 0;
        return bp - ap;
      });
      rows.forEach(row => tabela.appendChild(row));
    }

    document.addEventListener("DOMContentLoaded", async () => {
      const { data, error } = await client.from("zlecenia").select("*");
      if (data) {
        data.forEach(entry => {
          const row = tabela.insertRow();
          row.dataset.id = entry.id;
          row.innerHTML = `
            <td><input type="checkbox" class="pilne-check"></td>
            <td><input type="text" value="${entry.zaladunek || ''}"></td>
            <td><input type="date" value="${entry.data_zaladunku_od || ''}"> <input type="date" value="${entry.data_zaladunku_do || ''}"></td>
            <td><input type="time" value="${entry.godzina_zaladunku_od || ''}"> <input type="time" value="${entry.godzina_zaladunku_do || ''}"></td>
            <td><input type="text" value="${entry.rozladunek || ''}"></td>
            <td><input type="date" value="${entry.data_rozladunku_od || ''}"> <input type="date" value="${entry.data_rozladunku_do || ''}"></td>
            <td><input type="time" value="${entry.godzina_rozladunku_od || ''}"> <input type="time" value="${entry.godzina_rozladunku_do || ''}"></td>
            <td><input type="text" value="${entry.sposob_zaladunku || ''}"></td>
            <td><input type="text" value="${entry.aktualnosc || ''}"></td>
            <td><textarea>${entry.uwagi || ''}</textarea></td>
            <td><input type="number" value="${entry.stawka || ''}"></td>
            <td><input type="number" value="${entry.kilometry || ''}"></td>
            <td><input type="number" value="${entry.stawka_km || ''}"></td>
            <td><input type="checkbox" class="mapa-check"></td>
            <td><button>đź—‘ď¸Ź</button></td>
          `;
          podlaczZdarzeniaDoWiersza(row);
        });
        sortujPilneNaTopie();
      }
    });
  </script>
</body>
</html>
